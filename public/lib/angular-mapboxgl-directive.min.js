/*!
*  angular-mapboxgl-directive 0.29.0 2017-02-08
*  An AngularJS directive for Mapbox GL
*  git: git+https://github.com/Naimikan/angular-mapboxgl-directive.git
*/
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(a,b){"use strict";a.module("mapboxgl-directive",[]).directive("mapboxgl",["$q","mapboxglUtils","mapboxglConstants","mapboxglEventsUtils","mapboxglMapsData","mapboxglAnimationUtils",function(c,d,e,f,g,h){function i(b){a.extend(this,{_mapboxGlMap:c.defer(),_geojsonObjects:[],_imageObjects:[],_videoObjects:[],_markerObjects:[],_persistentGeojson:e.map.defaultPersistentGeojson,_persistentImage:e.map.defaultPersistentImage,_persistentVideo:e.map.defaultPersistentVideo,_elementDOM:null,getMap:function(){return this._mapboxGlMap.promise},getMapboxGlScope:function(){return b},getDOMElement:function(){return this._elementDOM},setDOMElement:function(a){this._elementDOM=a},getGeojsonObjects:function(){return this._geojsonObjects},addGeojsonObject:function(a){this._geojsonObjects.push(a)},removeGeojsonObjects:function(){this._geojsonObjects=[]},getImageObjects:function(){return this._imageObjects},addImageObject:function(a){this._imageObjects.push(a)},removeImageObjects:function(){this._imageObjects=[]},getVideoObjects:function(){return this._videoObjects},addVideoObject:function(a){this._videoObjects.push(a)},removeVideoObjects:function(){this._videoObjects=[]},getMarkerObjects:function(){return this._markerObjects},addMarkerObject:function(a){this._markerObjects.push(a)},removeMarkerObjects:function(){this._markerObjects=[]},isGeojsonPersistent:function(){return this._persistentGeojson},setPersistentGeojson:function(a){this._persistentGeojson=a},isImagePersistent:function(){return this._persistentImage},setPersistentImage:function(a){this._persistentImage=a},isVideoPersistent:function(){return this._persistentVideo},setPersistentVideo:function(a){this._persistentVideo=a},changeLoadingMap:function(a,b){b?this._elementDOM.hasClass("angular-mapboxgl-map-loading")||(a.getCanvas().style.opacity=.25,this._elementDOM.addClass("angular-mapboxgl-map-loading")):this._elementDOM.hasClass("angular-mapboxgl-map-loading")&&(a.getCanvas().style.opacity=1,this._elementDOM.removeClass("angular-mapboxgl-map-loading"))}})}function j(c,i,j,k){if(!b)throw new Error("Mapbox GL doesn`t included");if(!b.accessToken){if(!(a.isDefined(j.accessToken)&&j.accessToken.length>0))throw new Error("Mapbox access token doesn`t defined");b.accessToken=j.accessToken}if(!b.supported())throw new Error("Your browser doesn`t support Mapbox GL");if(a.isDefined(j.rtlEnabled)&&d.stringToBoolean(j.rtlEnabled)){if(!b.setRTLTextPlugin)throw new Error('Your version of Mapbox GL doesn`t support "setRTLTextPlugin" function.');b.setRTLTextPlugin(e.plugins.rtlPluginUrl)}k.setDOMElement(i),c.mapboxglMapId=j.id?j.id:d.generateMapId(),i.attr("id",c.mapboxglMapId);var l=function(a){isNaN(j.width)?i.css("width",j.width):i.css("width",j.width+"px"),a.resize()},m=function(a){isNaN(j.height)?i.css("height",j.height):i.css("height",j.height+"px"),a.resize()},n=function(b){a.isDefined(j.language)&&b.setLayoutProperty("country-label-lg","text-field","{name_"+j.language+"}")};a.isDefined(c.persistentGeojson)&&"boolean"==typeof c.persistentGeojson&&(k.setPersistentGeojson(c.persistentGeojson),c.$watch(function(){return c.persistentGeojson},function(){if("boolean"!=typeof c.persistentGeojson)throw new Error("Invalid parameter");k.setPersistentGeojson(c.persistentGeojson)})),a.isDefined(c.persistentImage)&&"boolean"==typeof c.persistentImage&&(k.setPersistentImage(c.persistentImage),c.$watch(function(){return c.persistentImage},function(){if("boolean"!=typeof c.persistentImage)throw new Error("Invalid parameter");k.setPersistentImage(c.persistentImage)})),a.isDefined(c.persistentVideo)&&"boolean"==typeof c.persistentVideo&&(k.setPersistentVideo(c.persistentVideo),c.$watch(function(){return c.persistentVideo},function(){if("boolean"!=typeof c.persistentVideo)throw new Error("Invalid parameter");k.setPersistentVideo(c.persistentVideo)}));var o={center:e.map.defaultCenter,zoom:a.isDefined(c.glZoom)&&null!==c.glZoom&&a.isDefined(c.glZoom.value)&&null!==c.glZoom.value?c.glZoom.value:e.map.defaultZoom,style:c.glStyle||e.map.defaultStyle,hash:a.isDefined(j.hash)?d.stringToBoolean(j.hash):e.map.defaultHash,bearingSnap:a.isDefined(j.bearingSnap)?d.stringToNumber(j.bearingSnap):e.map.defaultBearingSnap,failIfMajorPerformanceCaveat:a.isDefined(j.failIfMajorPerformanceCaveat)?d.stringToBoolean(j.failIfMajorPerformanceCaveat):e.map.defaultFailIfMajorPerformanceCaveat,preserveDrawingBuffer:a.isDefined(j.preserveDrawingBuffer)?d.stringToBoolean(j.preserveDrawingBuffer):e.map.defaultPreserveDrawingBuffer,trackResize:a.isDefined(j.trackResize)?d.stringToBoolean(j.trackResize):e.map.defaultTrackResize,renderWorldCopies:a.isDefined(j.renderWorldCopies)?d.stringToBoolean(j.renderWorldCopies):e.map.defaultRenderWorldCopies};d.validateAndFormatCenter(c.glCenter).then(function(d){d&&(o.center=d);var p=new b.Map({container:c.mapboxglMapId,style:o.style,center:o.center,zoom:o.zoom,hash:o.hash,bearingSnap:o.bearingSnap,failIfMajorPerformanceCaveat:o.failIfMajorPerformanceCaveat,preserveDrawingBuffer:o.preserveDrawingBuffer,trackResize:o.trackResize,renderWorldCopies:o.renderWorldCopies,attributionControl:!1});g.addMap(c.mapboxglMapId,p),f.exposeMapEvents(p),h.initAnimationSystem(),p.on("load",function(b){var d=b.target;k._mapboxGlMap.resolve(d),c.$watch(function(){return j.language},function(){d.loaded()?n(d):d.on("load",function(){n(d)})}),c.$watch(function(){return j.showCollisionBoxes},function(){"boolean"==typeof j.showCollisionBoxes&&(d.showCollisionBoxes=j.showCollisionBoxes)}),c.$watch(function(){return j.showTileBoundaries},function(){"boolean"==typeof j.showTileBoundaries&&(d.showTileBoundaries=j.showTileBoundaries)}),c.$watch(function(){return j.repaint},function(){"boolean"==typeof j.repaint&&(d.repaint=j.repaint)}),a.isDefined(j.width)&&(l(d),c.$watch(function(){return i[0].getAttribute("width")},function(){l(d)})),a.isDefined(j.height)?(m(d),c.$watch(function(){return i[0].getAttribute("height")},function(){m(d)})):(i.css("height",e.map.defaultHeight),d.resize())}),c.$on("mapboxglMap:styleChanged",function(){k.getMap().then(function(a){n(a)})}),c.$on("$destroy",function(){p.remove()})}).catch(function(a){})}var k={restrict:"EA",replace:!0,scope:{glStyle:"=",glCenter:"=",glMinZoom:"=",glMaxZoom:"=",glZoom:"=",glBearing:"=",glPitch:"=",glControls:"=",glFilter:"=",glClasses:"=",glInteractive:"=",glHandlers:"=",glImage:"=",glVideo:"=",glPopups:"=",glMarkers:"=",glLights:"=",glSources:"=",glLayers:"=",persistentGeojson:"=",persistentImage:"=",persistentVideo:"="},template:'<div class="angular-mapboxgl-map"></div>',controller:i,link:j};return i.$inject=["$scope"],k}]),a.module("mapboxgl-directive").directive("mapboxglCompare",["mapboxglMapsData",function(c){function d(d,e,f){if(!b)throw new Error("Mapbox GL does not included");if(!b.accessToken){if(!(a.isDefined(f.accessToken)&&f.accessToken.length>0))throw new Error("Mapbox access token does not defined");b.accessToken=f.accessToken}if(!b.Compare)throw new Error("mapboxgl.Compare plugin does not included");if(!b.supported())throw new Error("Your browser does not support Mapbox GL");if(a.isDefined(d.compareSettings)&&Object.prototype.toString.call(d.compareSettings)!==Object.prototype.toString.call({}))throw new Error("Invalid mapboxgl.Compare parameters");e.ready(function(){var f=e.children();if(2!==f.length)throw new Error("Only two maps can be compared");var g=a.element(f[0]);g.addClass("compare-map");var h=a.element(f[1]);h.addClass("compare-map");var i=c.getMapById(f[0].id),j=c.getMapById(f[1].id);new b.Compare(i,j,d.compareSettings);e.css("height",g.css("height")),d.$watch(function(){return g[0].getAttribute("height")},function(){e.css("height",g.css("height"))})})}var e={restrict:"EA",replace:!0,scope:{compareSettings:"="},transclude:!0,template:'<div class="angular-mapboxgl-compare" ng-transclude></div>',link:d};return e}]),a.module("mapboxgl-directive").factory("mapboxglAnimationUtils",["$window","$q","mapboxglUtils",function(b,c,d){function e(a){var b={};return s.forEach(function(c){c.animationParameters.deltaTime=a,c.animationFunction(c.animationParameters),b[c.animationParameters.sourceId]||(b[c.animationParameters.sourceId]={map:c.animationParameters.map,features:[]}),b[c.animationParameters.sourceId].features.push(c.animationParameters.feature)}),b}function f(b){for(var c in b){var d=b[c].map,e=d.getSource(c)._data;"FeatureCollection"===e.type?a.extend(e.features,b[c].features):"Feature"===e.type&&(e={type:"FeatureCollection",features:b[c].features}),d.getSource(c).setData(e)}}function g(a){s=s.filter(function(b){return b.sourceId!==a})}function h(a){s=s.filter(function(b){return b.featureId!==a})}function i(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var d=0,g=0,h=function(a){d+=a-g,g=a;var b=e(d);f(b),v=window.requestAnimationFrame(h)};v=window.requestAnimationFrame(h)}function j(){window.cancelAnimationFrame(v)}function k(a,b,c){var e=d.arrayObjectIndexOf(u,b,"sourceId");e===-1?u.push({map:a,sourceId:b,data:c}):u[e].data=c}function l(){u.map(function(a){a.map.getSource(a.sourceId).setData(a.data)})}function m(b,c,d,e){a.isDefined(d)&&a.isFunction(d)&&s.push({sourceId:b,featureId:c,animationFunction:d,animationParameters:e})}function n(b,c,e){if(a.isDefined(c)&&a.isFunction(c)){var f=d.arrayObjectIndexOf(s,b,"featureId");if(f===-1)throw new Error("Feature ID doesn't exist");a.extend(s[f].animationParameters,{animationFunction:c,animationData:e})}}function o(){s=[]}function p(){t=!0}function q(a){return d.arrayObjectIndexOf(s,a,"featureId")!==-1}function r(){var a=function(b){s.map(function(a){a.animationParameters.timestamp=b,a.animationFunction(a.animationParameters)}),t&&requestAnimationFrame(a)};a(0)}var s=[],t=!1,u=[],v=null,w={initAnimationSystem:i,addAnimationFunction:m,updateAnimationFunction:n,removeAnimationBySourceId:g,removeAnimationByFeatureId:h,removeAnimationStack:o,requestAnimationFrameNeeded:p,existAnimationByFeatureId:q,addSourceToAnimate:k,updateAnimationSources:l,animateFunctionStack:r,stopAnimationLoop:j};return w}]),a.module("mapboxgl-directive").factory("mapboxglEventsUtils",["$rootScope",function(a){function b(b){c.map(function(c){b.on(c,function(b){a.$broadcast("mapboxglMap:"+c,b)})})}var c=["resize","webglcontextlost","webglcontextrestored","remove","mouseup","mousedown","mouseout","render","tiledataloading","movestart","contextmenu","dblclick","click","touchcancel","touchmove","touchend","touchstart","sourcedataloading","styledataloading","mousemove","load","move","moveend","error","data","styledata","sourcedata","dataloading","tiledata","zoomend","zoom","zoomstart","boxzoomstart","boxzoomcancel","boxzoomend","rotatestart","rotate","rotateend","dragend","drag","dragstart","pitch"],d={exposeMapEvents:b};return d}]),a.module("mapboxgl-directive").factory("mapboxglImageUtils",["mapboxglUtils","mapboxglConstants",function(b,c){function d(c,d){b.checkObjects([{name:"Map",object:c},{name:"Layer object",object:d,attributes:["url","coordinates"]}]),d.id="image_"+Date.now(),c.addSource(d.id,{type:"image",url:d.url,coordinates:d.coordinates}),c.addLayer({id:d.id,source:d.id,type:"raster",layout:a.isDefined(d.layer)&&a.isDefined(d.layer.layout)?d.layer.layout:{},paint:a.isDefined(d.layer)&&a.isDefined(d.layer.paint)?d.layer.paint:{}})}var e={createImageByObject:d};return e}]),a.module("mapboxgl-directive").factory("mapboxglLayerUtils",["mapboxglUtils","mapboxglConstants","mapboxglPopupUtils",function(b,c,d){function e(){return p}function f(a){q=q.filter(function(b){return b.layerId!==a})}function g(){q=[]}function h(a){var b=q.filter(function(b){return b.layerId===a});return b.length>0&&b[0].popup}function i(a){r=r.filter(function(b){return b.layerId!==a})}function j(){r=[]}function k(a){var b=r.filter(function(b){return b.layerId===a});return b.length>0&&b[0].events}function l(c,d){b.checkObjects([{name:"Map",object:c},{name:"Layer object",object:d,attributes:["id","type"]}]);var e={type:"mapboxgl:"+d.type,popup:!!(a.isDefined(d.popup)&&a.isDefined(d.popup.enabled)&&d.popup.enabled)&&d.popup.enabled},f={};for(var g in d)"before"!==g&&"popup"!==g&&"animation"!==g&&"events"!==g&&(f[g]=d[g]);f.metadata=a.isDefined(d.metadata)?d.metadata:{},a.extend(f.metadata,e);var h=a.isDefined(d.before)?d.before:void 0;c.addLayer(f,h),p.push(d.id),q.push({layerId:d.id,popup:d.popup}),r.push({layerId:d.id,events:d.events})}function m(b){return a.isDefined(b)&&null!==b&&p.indexOf(b)!==-1}function n(a,c){if(b.checkObjects([{name:"Map",object:a}]),!m(c))throw new Error("Invalid layer ID");a.removeLayer(c),p=p.filter(function(a){return a!==c}),d.removePopupByLayerId(c),f(c),i(c)}function o(c,e){b.checkObjects([{name:"Map",object:c},{name:"Layer object",object:e,attributes:["id"]}]),a.isDefined(e.before)&&null!==e.before&&c.moveLayer(e.id,e.before),a.isDefined(e.filter)&&null!==e.filter&&a.isArray(e.filter)&&c.setFilter(e.id,e.filter);var g=c.getLayer(e.id);if(c.setLayerZoomRange(e.id,e.minzoom||g.minzoom,e.maxzoom||g.maxzoom),a.isDefined(e.popup)&&null!==e.popup&&(d.removePopupByLayerId(e.id),f(e.id),q.push({layerId:e.id,popup:e.popup})),a.isDefined(e.events)&&null!==e.events&&(i(e.id),r.push({layerId:e.id,events:e.events})),a.isDefined(e.paint)&&null!==e.paint)for(var h in e.paint)if(e.paint.hasOwnProperty(h)){var j=c.getPaintProperty(e.id,h);j!==e.paint[h]&&c.setPaintProperty(e.id,h,e.paint[h])}if(a.isDefined(e.layout)&&null!==e.layout)for(var k in e.layout)if(e.layout.hasOwnProperty(k)){var l=c.getLayoutProperty(e.id,k);l!==e.layout[k]&&c.setLayoutProperty(e.id,k,e.layout[k])}}var p=[],q=[],r=[],s={createLayerByObject:l,existLayerById:m,removeLayerById:n,updateLayerByObject:o,getCreatedLayers:e,removeAllPopupRelations:g,removePopupRelationByLayerId:f,getPopupRelationByLayerId:h,removeAllEventRelations:j,removeEventRelationByLayerId:i,getEventRelationByLayerId:k};return s}]),a.module("mapboxgl-directive").factory("mapboxglMapsData",["mapboxglUtils",function(a){function b(a,b){g.push({id:a,mapInstance:b})}function c(b){var c=a.arrayObjectIndexOf(g,b,"id");if(c!==-1){var d=g[c];d.mapInstance.remove(),g.splice(c,1)}}function d(){g.map(function(a){a.mapInstance.remove()}),g=[]}function e(){return g}function f(b){var c=a.arrayObjectIndexOf(g,b,"id");return c!==-1?g[c].mapInstance:null}var g=[],h={addMap:b,removeMapById:c,removeAllMaps:d,getMaps:e,getMapById:f};return h}]),a.module("mapboxgl-directive").factory("mapboxglMarkerUtils",["mapboxglUtils","mapboxglConstants","mapboxglPopupUtils",function(c,d,e){function f(d,f){c.checkObjects([{name:"Map",object:d},{name:"Object",object:f,attributes:["coordinates","element"]}]);var g=f.options||{},h=new b.Marker(f.element,g).setLngLat(f.coordinates);if(a.isDefined(f.popup)){var i=e.createPopupByObject(d,f.popup);h.setPopup(i)}return h.addTo(d),h}var g={createMarkerByObject:f};return g}]),a.module("mapboxgl-directive").factory("mapboxglPopupUtils",["mapboxglUtils","mapboxglConstants","$rootScope","$compile",function(c,d,e,f){function g(){return l}function h(b){var c=l.filter(function(a){return a.layerId===b});return a.isUndefined(b)||null===b?c.map(function(a){return a.popupInstance}):c.length>0?c[0].popupInstance:void 0}function i(a){l.map(function(a){a.popupInstance.remove()}),l=[]}function j(a,b){var c=l.filter(function(a){return a.layerId===b});c.map(function(a){a.popupInstance.remove()}),l=l.filter(function(a){return a.layerId!==b})}function k(d,g,h){c.checkObjects([{name:"Map",object:d},{name:"Object",object:h,attributes:["coordinates","html"]}]);var i=h.options||{},j=new b.Popup(i).setLngLat(h.coordinates);if(h.html instanceof HTMLElement)j.setDOMContent(h.html);else{var k=a.isDefined(h.getScope)&&a.isFunction(h.getScope)?h.getScope():e,o=a.copy(h.html);if(m.test(h.html)){var p=h.html.match(m);p.length>0&&p.forEach(function(a){var b=a.match(n);if(b.length>0){var c=b[0];if(!g.properties.hasOwnProperty(c))throw new Error('Property "'+c+'" isn\'t exist in source "'+g.layer.source+'"');o=o.replace(a,g.properties[c])}})}try{var q=f(o)(k)[0];j.setDOMContent(q)}catch(a){j.setHTML(o)}}return j.addTo(d),l.push({popupInstance:j,layerId:g.layer.id}),j}var l=[],m=new RegExp(/\$\{(.+?)\}/g),n=new RegExp(/[^\$\{](.+)[^\}]/g),o={createPopupByObject:k,getAllPopupsCreated:g,getPopupByLayerId:h,removeAllPopupsCreated:i,removePopupByLayerId:j};return o}]),a.module("mapboxgl-directive").factory("mapboxglSourceUtils",["mapboxglUtils","mapboxglConstants","mapboxglAnimationUtils","$q",function(b,c,d,e){function f(a,b,c,e){var f=function(a){a.animationFunction(a.map,a.sourceId,a.featureId,a.feature,a.animationData,a.deltaTime,a.end)};d.addAnimationFunction(b,c,f,{map:a,sourceId:b,featureId:c,feature:e,animationData:e.properties.animation.animationData,deltaTime:0,animationFunction:e.properties.animation.animationFunction,end:function(){d.removeAnimationByFeatureId(c)}})}function g(c,d){b.checkObjects([{name:"Map",object:c},{name:"Source object",object:d,attributes:["id","type","data"]}]);var e={};for(var g in d)"id"!==g&&(e[g]=d[g]);a.isDefined(e.data)&&(a.isDefined(e.data.features)&&a.isArray(e.data.features)?e.data.features=e.data.features.map(function(c){return a.isUndefined(c.properties)&&(c.properties={}),a.isUndefined(c.properties.featureId)&&(c.properties.featureId=b.generateGUID()),c}):(a.isUndefined(e.data.properties)&&(e.data.properties={}),a.isUndefined(e.data.properties.featureId)&&(e.data.properties.featureId=b.generateGUID()))),c.addSource(d.id,e),l.push(d.id);var h=c.getSource(d.id);a.isDefined(h._data)&&a.isDefined(h._data.features)&&a.isArray(h._data.features)?h._data.features.map(function(b,e){a.isDefined(b.properties)&&a.isDefined(b.properties.animation)&&a.isDefined(b.properties.animation.enabled)&&b.properties.animation.enabled&&a.isDefined(b.properties.animation.animationFunction)&&a.isFunction(b.properties.animation.animationFunction)&&f(c,d.id,b.properties.featureId,b)}):a.isDefined(h._data)&&a.isDefined(h._data.properties)&&a.isDefined(h._data.properties.animation)&&a.isDefined(h._data.properties.animation.enabled)&&h._data.properties.animation.enabled&&a.isDefined(h._data.properties.animation.animationFunction)&&a.isFunction(h._data.properties.animation.animationFunction)&&f(c,d.id,h._data.properties.featureId,h._data)}function h(b){var c=!1;return a.isDefined(b)&&null!==b&&(c=l.indexOf(b)!==-1),c}function i(a,c){if(b.checkObjects([{name:"Map",object:a}]),!h(c))throw new Error("Invalid source ID");a.removeSource(c),d.removeAnimationBySourceId(c),l=l.filter(function(a){return a!==c})}function j(c,e){b.checkObjects([{name:"Map",object:c},{name:"Source object",object:e,attributes:["id","data"]}]);var g=c.getSource(e.id);b.checkObjects([{name:"Source "+e.id,object:g}]),a.isDefined(g._data)&&a.isDefined(g._data.features)&&a.isArray(g._data.features)&&g._data.features.length>0?g._data.features.map(function(b,g){a.isDefined(b.properties)&&a.isDefined(b.properties.animation)&&a.isDefined(b.properties.animation.enabled)&&b.properties.animation.enabled&&a.isDefined(b.properties.animation.animationFunction)&&a.isFunction(b.properties.animation.animationFunction)&&(d.existAnimationByFeatureId(b.properties.featureId)?d.updateAnimationFunction(b.properties.featureId,b.properties.animation.animationFunction,b.properties.animation.animationData):f(c,e.id,b.properties.featureId,b))}):a.isDefined(g._data)&&a.isDefined(g._data.properties)&&a.isDefined(g._data.properties.animation)&&a.isDefined(g._data.properties.animation.enabled)&&g._data.properties.animation.enabled&&a.isDefined(g._data.properties.animation.animationFunction)&&a.isFunction(g._data.properties.animation.animationFunction)?d.existAnimationByFeatureId(g._data.properties.featureId)?d.updateAnimationFunction(g._data.properties.featureId,g._data.properties.animation.animationFunction,g._data.properties.animation.animationData):f(c,e.id,g._data.properties.featureId,g._data):g.setData(e.data)}function k(){return l}var l=[],m={createSourceByObject:g,existSourceById:h,removeSourceById:i,updateSourceByObject:j,getCreatedSources:k};return m}]),a.module("mapboxgl-directive").factory("mapboxglUtils",["$window","$q",function(b,c){function d(){return"mapbox-gl-map-"+Date.now()}function e(d){var e=c.defer();return a.isDefined(d)?a.isDefined(d.autodiscover)&&d.autodiscover?b.navigator.geolocation.getCurrentPosition(function(a){var b=a.coords;e.resolve([b.longitude,b.latitude])},function(a){e.reject(a)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):a.isNumber(d.lat)&&a.isNumber(d.lng)&&(d.lng>-180||d.lng<180)&&(d.lat>-90||d.lat<90)?e.resolve([d.lng,d.lat]):a.isArray(d)&&2===d.length&&a.isNumber(d[0])&&a.isNumber(d[1])&&(d[0]>-180||d[0]<180)&&(d[1]>-90||d[1]<90)?e.resolve(d):e.resolve(!1):e.resolve(!1),e.promise}function f(a,b,c){for(var d=0,e=a.length;d<e;d++)if(a[d][c]===b)return d;return-1}function g(b){var c=!1;return a.isDefined(b)&&null!==b&&(c="true"===b.toLowerCase()),c}function h(b){if(a.isDefined(b)&&null!==b){var c=+b;if(isNaN(c))throw new Error("mapboxglUtils.stringToNumber --> Invalid stringValue");return c}}function i(b){a.isDefined(b)&&a.isArray(b)&&b.map(function(b){if(a.isUndefined(b.object)||null===b.object)throw new Error(b.name+" is undefined");a.isDefined(b.attributes)&&a.isArray(b.attributes)&&b.attributes.map(function(c){if(a.isUndefined(b.object[c]||null===b.object[c]))throw new Error(b.name+" "+c+" is undefined")})})}function j(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}var k={generateMapId:d,validateAndFormatCenter:e,arrayObjectIndexOf:f,stringToBoolean:g,stringToNumber:h,checkObjects:i,generateGUID:j};return k}]),a.module("mapboxgl-directive").factory("mapboxglVideoUtils",["mapboxglUtils","mapboxglConstants",function(b,c){function d(c,d){b.checkObjects([{name:"Map",object:c},{name:"Layer object",object:d,attributes:["urls","coordinates"]}]),d.id="video_"+Date.now(),c.addSource(d.id,{type:"video",urls:d.url,coordinates:d.coordinates}),c.addLayer({id:d.id,source:d.id,type:"raster",layout:a.isDefined(d.layer)&&a.isDefined(d.layer.layout)?d.layer.layout:{},paint:a.isDefined(d.layer)&&a.isDefined(d.layer.paint)?d.layer.paint:{}})}var e={createVideoByObject:d};return e}]),a.module("mapboxgl-directive").constant("mapboxglConstants",{map:{defaultHeight:"450px",defaultStyle:"mapbox://styles/mapbox/streets-v9",defaultCenter:[0,0],defaultZoom:0,defaultHash:!1,defaultBearingSnap:7,defaultFailIfMajorPerformanceCaveat:!1,defaultPreserveDrawingBuffer:!1,defaultTrackResize:!0,defaultRenderWorldCopies:!0,defaultPersistentGeojson:!1,defaultPersistentImage:!1,defaultPersistentVideo:!1},source:{defaultMaxZoom:18,defaultBuffer:128,defaultTolerance:.375,defaultCluster:!1,defaultClusterRadius:50},plugins:{rtlPluginUrl:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.1.0/mapbox-gl-rtl-text.js"}}),a.module("mapboxgl-directive").directive("glBearing",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glBearing",function(c){if(a.isDefined(c)){if(!a.isNumber(c.value))throw new Error("Invalid bearing");b.setBearing(c.value,c.eventData)}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glCenter",["mapboxglUtils","mapboxglConstants",function(b,c){function d(d,e,f,g){if(!g)throw new Error("Invalid angular-mapboxgl-directive controller");var h=g.getMapboxGlScope();g.getMap().then(function(d){h.$watch("glCenter",function(e,f){b.validateAndFormatCenter(e).then(function(b){if(!b)throw new Error("Invalid center");a.isDefined(f)&&e!==f?d.flyTo({center:b}):d.setCenter(b)}).catch(function(a){throw d.setCenter(c.map.defaultCenter),new Error(a.code+" / "+a.message)})},!0)})}var e={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:d};return e}]),a.module("mapboxgl-directive").directive("glClasses",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glClasses",function(c){if(a.isDefined(c))b.setClasses(c.classes,c.options);else{var d=b.getClasses();d.map(function(a){b.removeClass(a)})}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glControls",["$rootScope","$window",function(c,d){function e(e,f,g,h){if(!h)throw new Error("Invalid angular-mapboxgl-directive controller");var i=h.getMapboxGlScope(),j={custom:[]},k=function(b,c,d,e,f){d?j.custom.push({name:b||"customControl_"+Date.now(),control:c,isEventsListenedByMap:!!a.isDefined(f)&&f,events:a.isDefined(e)&&a.isArray(e)?e:[]}):j[b]={control:c,isEventsListenedByMap:!!a.isDefined(f)&&f,events:a.isDefined(e)&&a.isArray(e)?e:[]}},l=function(a,b,c,d){c?b.map(function(a){d.off(a)}):b.map(function(b){a.off(b)})},m=function(a){for(var b in j)if("custom"!==b){var c=j[b];l(c.control,c.events,c.isEventsListenedByMap,a),a.removeControl(c.control)}else for(var d=j[b],e=0,f=d.length;e<f;e++){var g=d[e];l(g.control,g.events,g.isEventsListenedByMap,a),a.removeControl(g.control)}j={custom:[]}},n=[{name:"navigation",constructor:b.Navigation||b.NavigationControl,pluginName:"mapboxgl."+(b.Navigation?b.Navigation.name:b.NavigationControl.name)},{name:"scale",constructor:b.Scale||b.ScaleControl,pluginName:"mapboxgl."+(b.Scale?b.Scale.name:b.ScaleControl.name)},{name:"attribution",constructor:b.Attribution||b.AttributionControl,pluginName:"mapboxgl."+(b.Attribution?b.Attribution.name:b.AttributionControl.name)},{name:"geolocate",constructor:b.Geolocate||b.GeolocateControl,pluginName:"mapboxgl."+(b.Geolocate?b.Geolocate.name:b.GeolocateControl.name),eventsExposedName:"mapboxglGeolocate",eventsAvailables:["geolocate","error"]},{name:"geocoder",constructor:b.Geocoder||d.MapboxGeocoder,pluginName:b.Geocoder?"mapboxgl.Geocoder":"MapboxGeocoder",eventsExposedName:"mapboxglGeocoder",eventsAvailables:["clear","loading","results","result","error"]},{name:"directions",constructor:b.Directions||d.MapboxDirections,pluginName:b.Directions?"mapboxgl.Directions":"MapboxDirections",eventsExposedName:"mapboxglDirections",eventsAvailables:["clear","loading","profile","origin","destination","route","error"]},{name:"draw",constructor:b.Draw||d.MapboxDraw,pluginName:b.Draw?"mapboxgl.Draw":"MapboxDraw",eventsExposedName:"mapboxglDraw",listenInMap:!0,eventsAvailables:["draw.create","draw.delete","draw.combine","draw.uncombine","draw.update","draw.selectionchange","draw.modechange","draw.render","draw.actionable"]}];h.getMap().then(function(b){i.$watch("glControls",function(d){if(a.isDefined(d)&&(m(b),n.map(function(e){if(a.isDefined(d[e.name])&&a.isDefined(d[e.name].enabled)&&d[e.name].enabled){if(!a.isDefined(e.constructor)||!a.isFunction(e.constructor))throw new Error(e.pluginName+" plugin is not included.");var f=e.constructor.bind.apply(e.constructor,d[e.name].options),g=new f(d[e.name].options);if(k(e.name,g,!1,e.eventsAvailables,e.listenInMap),a.isDefined(e.eventsAvailables)&&a.isDefined(e.eventsExposedName)){var h=e.listenInMap?b:g;e.eventsAvailables.map(function(a){h.on(a,function(b){var d=e.eventsExposedName+":"+a;c.$broadcast(d,b)})})}var i=d[e.name].options&&d[e.name].options.position?d[e.name].options.position:void 0;b.addControl(g,i)}}),a.isDefined(d.custom))){if(!a.isArray(d.custom))throw new Error("'custom' must be an array");d.custom.map(function(d){if(a.isDefined(d.constructor)){var e=d.constructor.bind.apply(d.constructor,d.options),f=new e(d.options),g=a.isArray(d.events)?d.events:[];k(d.name,f,!0,g,d.listenInMap);var h=d.listenInMap?b:f;g.map(function(a){h.on(a,function(b){var e="mapboxgl:"+d.name+":"+a;c.$broadcast(e,b)})});var i=d.options&&d.options.position?d.options.position:void 0;b.addControl(f,i)}})}})})}var f={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:e};return f}]),a.module("mapboxgl-directive").directive("glFilter",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glFilter",function(c){if(a.isDefined(c))if(Object.prototype.toString.call(c)===Object.prototype.toString.call({})){if(!(a.isDefined(c.layerId)&&a.isDefined(c.filter)&&a.isArray(c.filter)))throw new Error("Invalid filter parameter");b.setFilter(c.layerId,c.filter)}else{if(Object.prototype.toString.call(c)!==Object.prototype.toString.call([]))throw new Error("Invalid filter parameter");c.map(function(c){if(!(a.isDefined(c.layerId)&&a.isDefined(c.filter)&&a.isArray(c.filter)))throw new Error("Invalid filter parameter");b.setFilter(c.layerId,c.filter)})}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glHandlers",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glHandlers",function(c){if(a.isDefined(c)&&Object.prototype.toString.call(c)===Object.prototype.toString.call({}))for(var d in c)if(c.hasOwnProperty(d)){var e=c[d]?"enable":"disable";b[d][e]()}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glImage",["mapboxglImageUtils",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h=function(c,d,e){if(a.isDefined(e))if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))b.createImageByObject(c,e),d.addImageObject(e);else{if(Object.prototype.toString.call(e)!==Object.prototype.toString.call([]))throw new Error("Invalid image parameter");e.map(function(a){b.createImageByObject(c,a),d.addImageObject(a)})}};c.$on("mapboxglMap:styleChanged",function(){if(f.isImagePersistent()){var b=a.copy(f.getImageObjects());f.removeImageObjects(),f.getMap().then(function(a){h(a,f,b)})}else f.removeImageObjects()}),f.getMap().then(function(a){g.$watchCollection("glImage",function(b){a.style.loaded()?h(a,f,b):a.once("style.load",function(){h(a,f,b)})})})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glInteractive",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=["touchZoomRotate","scrollZoom","boxZoom","dragRotate","dragPan","doubleClickZoom","keyboard"],g=e.getMapboxGlScope();e.getMap().then(function(b){g.$watch("glInteractive",function(c){if(a.isDefined(c)&&"boolean"==typeof c){var d=c?"enable":"disable";f.map(function(a){b[a][d]()})}})})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glLayers",["mapboxglLayerUtils","mapboxglPopupUtils","$timeout","$q",function(b,c,d,e){function f(d,f,g,h){function i(a){c.removeAllPopupsCreated(a),a.off("click"),a.off("mousemove")}function j(d){d.on("click",function(e){e.originalEvent.preventDefault(),
e.originalEvent.stopPropagation();var f=b.getCreatedLayers(),g=d.queryRenderedFeatures(e.point,{layers:f});if(g.length>0){var h=g[0],i=b.getPopupRelationByLayerId(h.layer.id);a.isDefined(i)&&null!==i&&c.createPopupByObject(d,h,{coordinates:e.lngLat,options:i.options,html:i.message,getScope:i.getScope});var j=b.getEventRelationByLayerId(h.layer.id);a.isDefined(j)&&null!==j&&a.isDefined(j.onClick)&&a.isFunction(j.onClick)&&j.onClick(d,h,g)}}),d.on("mousemove",function(c){var e=b.getCreatedLayers(),f=d.queryRenderedFeatures(c.point,{layers:e});if(d.getCanvas().style.cursor=f.length?"pointer":"",f.length>0){var g=f[0],h=b.getEventRelationByLayerId(g.layer.id);a.isDefined(h)&&null!==h&&a.isDefined(h.onMouseover)&&a.isFunction(h.onMouseover)&&h.onMouseover(d,g,f)}})}function k(c,d){if(b.existLayerById(d.id)?b.updateLayerByObject(c,d):b.createLayerByObject(c,d),a.isDefined(d.animation)&&a.isDefined(d.animation.enabled)&&d.animation.enabled){var e=function(a){setTimeout(function(){requestAnimationFrame(e),d.animation.animationFunction(c,d.id,d.animation.animationData,a)},d.animation.timeoutMilliseconds||1e3)};e(0)}}function l(c,d){var f=e.defer(),g=[];Object.prototype.toString.call(d)===Object.prototype.toString.call([])?g=d.map(function(a){return a.id}):Object.prototype.toString.call(d)===Object.prototype.toString.call({})?g.push(d.id):f.reject(new Error("Invalid layers parameter")),g=g.filter(function(b){return a.isDefined(b)});var h=b.getCreatedLayers();return g.map(function(a){h=h.filter(function(b){return b!==a})}),h.map(function(a){b.removeLayerById(c,a)}),f.resolve(),f.promise}if(!h)throw new Error("Invalid angular-mapboxgl-directive controller");var m=h.getMapboxGlScope();h.getMap().then(function(b){m.$watch("glLayers",function(c){a.isDefined(c)&&(i(b),l(b,c).then(function(){if(Object.prototype.toString.call(c)===Object.prototype.toString.call([]))c.map(function(a){k(b,a)});else{if(Object.prototype.toString.call(c)!==Object.prototype.toString.call({}))throw new Error("Invalid layers parameter");k(b,c)}j(b)}).catch(function(a){throw a}))},!0)})}var g={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:f};return g}]),a.module("mapboxgl-directive").directive("glLights",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glLights",function(c){a.isDefined(c)&&b.setLight(c.options,c.lightOptions)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMarkers",["mapboxglMarkerUtils",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h=[],i=function(){h.map(function(a){a.remove()}),h=[]},j=function(c,d){if(a.isDefined(d))if(i(),Object.prototype.toString.call(d)===Object.prototype.toString.call({})){var e=b.createMarkerByObject(c,d);h.push(e)}else{if(Object.prototype.toString.call(d)!==Object.prototype.toString.call([]))throw new Error("Invalid marker parameter");d.map(function(a){var d=b.createMarkerByObject(c,a);h.push(d)})}};f.getMap().then(function(a){g.$watchCollection("glMarkers",function(b){j(a,b)})})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glMaxBounds",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMaxBounds",function(c){if(!a.isArray(c)||2!==c.length)throw new Error("Invalid max bounds");b.setMaxBounds(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMaxZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMaxZoom",function(c){if(!a.isNumber(c)||!(c>=0||c<=20))throw new Error("Invalid max zoom");b.setMaxZoom(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMinZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMinZoom",function(c){if(!a.isNumber(c)||!(c>=0||c<=20))throw new Error("Invalid min zoom");b.setMinZoom(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glPitch",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glPitch",function(c){if(a.isDefined(c)){if(!a.isNumber(c.value)||!(c.value>=0||c.value<=60))throw new Error("Invalid pitch");b.setPitch(c.value,c.eventData)}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glPopups",["mapboxglPopupUtils",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h=[],i=function(){h.map(function(a){a.remove()}),h=[]},j=function(c,d){if(a.isDefined(d))if(i(),Object.prototype.toString.call(d)===Object.prototype.toString.call({})){var e=b.createPopupByObject(c,d);h.push(e)}else{if(Object.prototype.toString.call(d)!==Object.prototype.toString.call([]))throw new Error("Invalid popup parameter");d.map(function(a){var d=b.createPopupByObject(c,a);h.push(d)})}};f.getMap().then(function(a){g.$watchCollection("glPopups",function(b){j(a,b)})})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glSources",["mapboxglSourceUtils","$timeout","$q",function(b,c,d){function e(c,e,f,g){function h(a,c){b.existSourceById(c.id)?b.updateSourceByObject(a,c):b.createSourceByObject(a,c)}function i(c,e){var f=d.defer(),g=[];Object.prototype.toString.call(e)===Object.prototype.toString.call([])?g=e.map(function(a){return a.id}):Object.prototype.toString.call(e)===Object.prototype.toString.call({})?g.push(e.id):f.reject(new Error("Invalid sources parameter")),g=g.filter(function(b){return a.isDefined(b)});var h=b.getCreatedSources();return g.map(function(a){h=h.filter(function(b){return b!==a})}),h.map(function(a){b.removeSourceById(c,a)}),f.resolve(),f.promise}if(!g)throw new Error("Invalid angular-mapboxgl-directive controller");var j=g.getMapboxGlScope();g.getMap().then(function(b){j.$watch("glSources",function(c){a.isDefined(c)&&i(b,c).then(function(){if(Object.prototype.toString.call(c)===Object.prototype.toString.call([]))c.map(function(a){h(b,a)});else{if(Object.prototype.toString.call(c)!==Object.prototype.toString.call({}))throw new Error("Invalid sources parameter");h(b,c)}}).catch(function(a){throw a})},!0)})}var f={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:e};return f}]),a.module("mapboxgl-directive").directive("glStyle",["$rootScope",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope();f.getMap().then(function(c){g.$watch("glStyle",function(d,e){if(a.isDefined(d)&&null!==d&&d!==e){var f=!1;c.setStyle(d),c.on("styledata",function(a){f||(b.$broadcast("mapboxglMap:styleChanged",{map:c,newStyle:d,oldStyle:e}),f=!0)})}},!0)})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glVideo",["mapboxglVideoUtils",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h=function(c,d,e){if(a.isDefined(e))if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))b.createVideoByObject(c,e),d.addVideoObject(e);else{if(Object.prototype.toString.call(e)!==Object.prototype.toString.call([]))throw new Error("Invalid video parameter");e.map(function(a){b.createVideoByObject(c,a),d.addVideoObject(a)})}};f.getMap().then(function(a){g.$watchCollection("glVideo",function(b){a.loaded()?h(a,f,b):a.on("load",function(){h(a,f,b)})})})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glZoom",function(c){if(a.isDefined(c)){if(!a.isNumber(c.value)||!(c.value>=0||c.value<=20))throw new Error("Invalid zoom");b.setZoom(c.value,c.eventData)}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}])}(angular,mapboxgl)},{}]},{},[1]);