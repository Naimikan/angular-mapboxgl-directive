<!DOCTYPE html>
<html ng-app="app">
  <head>
    <title></title>

    <link href="https://api.mapbox.com/mapbox-gl-js/v0.31.0/mapbox-gl.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/angular-mapboxgl-directive/0.26.0/angular-mapboxgl-directive.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular.min.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.31.0/mapbox-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-mapboxgl-directive/0.26.0/angular-mapboxgl-directive.min.js"></script>

    <script>
      var app = angular.module('app', ['mapboxgl-directive'])

      .run([function () {
        mapboxgl.accessToken = 'pk.eyJ1IjoibmFpbWlrYW4iLCJhIjoiY2lraXJkOXFjMDA0OXdhbTYzNTE0b2NtbiJ9.O64XgZQHNHcV2gwNLN2a0Q';
      }])

      .controller('CustomControlController', ['$scope', function ($scope) {
        function CustomControl (options) {
          this.options = this.options || {};

          mapboxgl.util.extend(this.options, options);
        }

        CustomControl.prototype = new mapboxgl.Evented();

        mapboxgl.util.extend(CustomControl.prototype, {
          options: {
            position: 'bottom-left'
          },

          onAdd: function (map) {
            var self = this;

            self.map = map;

            var container = document.createElement('div');
            container.className = 'mapboxgl-ctrl';

            map.getContainer().appendChild(container);

            var buttonContainer = document.createElement('div');
            var button = document.createElement('button');
            button.className = 'mapboxgl-ctrl-icon';
            button.style.height = '30px';
            button.style.width = '30px';
            button.style['background-color'] = '#EF444D';

            button.addEventListener('click', function (event) {
              event.preventDefault();
              event.stopPropagation();

              self.fire('buttonClicked', event);
            });

            buttonContainer.appendChild(button);

            container.appendChild(buttonContainer);

            return container;
          }
        });

        $scope.glControls = {
          custom: [
            {
              constructor: CustomControl,
              name: 'CustomControl1',
              options: {
                position: 'bottom-right'
              },
              events: ['buttonClicked']
            }
          ]
        };

        $scope.$on('mapboxgl:CustomControl1:buttonClicked', function (event, controlEvent) {
          alert(event.name);
        });
      }]);
    </script>
  </head>
  <body ng-controller="CustomControlController">
    <div mapboxgl gl-controls="glControls"></div>
  </body>
</html>
