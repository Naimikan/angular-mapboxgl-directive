<!DOCTYPE html>
<html ng-app="app">
  <head>
    <title></title>

    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-mapboxgl-directive/0.43.2/angular-mapboxgl-directive.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular.min.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-mapboxgl-directive/0.43.2/angular-mapboxgl-directive.min.js"></script>

    <script>
      var app = angular.module('app', ['mapboxgl-directive'])

      .run([function () {
        mapboxgl.accessToken = '<YOUR_MAPBOXGL_TOKEN>';
      }])

      .controller('ClusterPointsController', ['$scope', function ($scope) {
        $scope.glSources = [
          {
            id: 'earthquakes',
            type: 'geojson',
            data: './assets/earthquakes.geojson',
            cluster: true,
            clusterMaxZoom: 14,
            clusterRadius: 50
          }
        ];

        $scope.glLayers = [
          {
            id: 'clusters',
            type: 'circle',
            source: 'earthquakes',
            filter: ['has', 'point_count'],
            paint: {
              'circle-color': {
                property: 'point_count',
                type: 'interval',
                stops: [
                  [0, '#51bbd6'],
                  [100, '#f1f075'],
                  [750, '#f28cb1'],
                ]
              },
              'circle-radius': {
                property: 'point_count',
                type: 'interval',
                stops: [
                  [0, 20],
                  [100, 30],
                  [750, 40]
                ]
              }
            }
          }, {
            id: 'cluster-count',
            type: 'symbol',
            source: 'earthquakes',
            filter: ['has', 'point_count'],
            layout: {
              'text-field': '{point_count_abbreviated}',
              'text-size': 12
            }
          }, {
            id: 'unclustered-point',
            type: 'circle',
            source: 'earthquakes',
            filter: ['!has', 'point_count'],
            paint: {
              'circle-color': '#11b4da',
              'circle-radius': 4,
              'circle-stroke-width': 1,
              'circle-stroke-color': '#ffffff'
            }
          }
        ];
      }]);
    </script>
  </head>
  <body ng-controller="ClusterPointsController">
    <div mapboxgl
      gl-center="[-103.59179687498357, 40.66995747013945]"
      gl-zoom="{ value: 3 }"
      gl-style="'mapbox://styles/mapbox/dark-v9'"
      gl-sources="glSources"
      gl-layers="glLayers">
    </div>
  </body>
</html>
